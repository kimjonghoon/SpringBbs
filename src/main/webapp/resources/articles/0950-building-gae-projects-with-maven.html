<article>

<h1>구글 앱 엔진 시작하기</h1>

<h2>서비스 신청</h2>

<p>
<a href="https://cloud.google.com">https://cloud.google.com</a>에서 비자 또는 마스터 신용카드나 체크카드로 서비스를 신청할 수 있다.
구글 계정에 로그인해야 서비스 신청을 할 수 있다.
</p>

<p>
서비스 신청 후 구글은 1년간 사용할 수 있는 300달러 바우처를 제공한다.
1년간 300달러에 해당하는 서비스를 체험하는 것은 무료이다.
300달러를 소진하거나 1년이 지나면 구글은 서비스를 계속 사용할지를 묻는다.
서비스를 계속 사용하겠다는 확답을 주면, 구글은 서비스 비용을 0으로 초기화하고 이후 발생한 서비스 비용은 신청시 등록한 카드로 자동 결재한다.
사용자는 바우처를 사용하는 동안 자신에 맞는 서비스를 정하고 예산을 수립해야 한다.
</p>

<h2>프로젝트 생성</h2>

<p>
신청을 완료하고 다시 <a href="https://cloud.google.com">https://cloud.google.com</a>을 방문하면 GO TO CONSOLE 버튼이 보일 것이다.
이 버튼을 클릭하여 웹 콘솔 화면으로 이동한다.
</p>

<p>
웹 콘솔에서 프로젝트를 생성한다.
왼쪽 위 Google Cloud Platform 옆에서 프로젝트 생성 메뉴를 찾아 실행한다.
<img alt="새 프로젝트 이름과 아이디 지정" src="https://lh3.googleusercontent.com/0sv1GHn6s-XXPN2ObCQxViZwgDG1aHRWFsG_mY63rlJeNIpKdyo7E5cwXRLxF4o7T3GCX-u3IPyodnlORu0AjUEMPE-y3GTUU9XfGwCb4cEO0G7OLfzvCy4HTK87zUyd216efpND8J13pa_l10lsx3wL41CcFTT64oahY1R-5-fOsHWw6_h5YbwA6YJ71S8wRGryMQ9rx7sooKWG3LSik-GAcf7Sy3_kOjt4_UaC4UQQlltwAdaBNu7XAUnCrD9Wc6jCJppfz8TkVOeDIBbW19XvjxYdgznhxZ1xA7-z89GhaBcIKTyHeRaYE-9W2EgE1VHfQAdNKGiYaN6dPwKTnQqLcLBetq3MmFMtIFf0ojonoxFmIAKrHp2Vflhjts_MCfz_6OM59vEI_oLGCf9aKj93mIwkMxMGYb5YWjuT_tAzYmIeIKoV5nQTXx5rrAr7l2KS8hYgsJ8u2pF_11H363aZz-b3I-NTKNAljFwoDQGxFX7BWDGSJi--h6FoFQVx5QNbTZ_1r1C_-C0pc0KXJ8mVlzksQ3Vd3nht7YAQGPVtOkg7COEdI0eAhMIoedf3gDJ2a9kI5matFKocR4Nyrp7lgKEy0xbFc8SI6kGKK2q93GzjngPPf-wd=w495-h297-no" style="display: block;" />
프로젝트 이름을 입력하면 프로젝트 아이디는 프로젝트 이름-숫자 형태로 만들어진다.
프로젝트 이름을 독특하게 지으면 프로젝트 이름과 프로젝트 아이디가 같을 수 있다.
기억해야 할 것은 프로젝트 아이디다.
</p>

<h2>개발 환경</h2>

<h3>자바</h3>

<p>
최신 자바를 설치한다.
설치 과정은 <a href="/">JDK 설치</a>를 참조한다.
</p>

<h3>메이븐</h3>

<p>
<a href="/spring/building-java-projects-with-maven#Install-Maven">메이븐 설치</a>를 참조하여 최신 버전을 설치한다.
<p>

<h3>Cloud SDK</h3>

<p>
<a href="https://cloud.google.com/sdk/downloads">https://cloud.google.com/sdk/downloads</a>를 참조해 설치한다.
</p>

<p>
윈도에서 환경 변수 PATH에 Cloud SDK의 bin 경로를 추가하려면 다음을 관리자 권한으로 실행한다.
</p>

<pre class="screen">
.\google-cloud-sdk\install.bat
</pre>

<p>
명령 프롬프트를 관리자 권한으로 연다.
다음 명령을 실행해서 app-engine-java 컴포넌트를 설치한다. 
</p>

<pre class="screen">
gcloud components install app-engine-java
</pre>

<p>
gcloud 초기화를 진행한다.
</p>

<pre class="screen">
gcloud init
</pre>

<p>
사용할 프로젝트와 Google Compute Engine의 존(zone) 지정한다.
명령을 실행하기 전에 구글 클라우드 콘솔에서 프로젝트를 생성해야 한다. 우리는 이 작업을 이미 했다.
존 지정은 인스턴스가 생성될 지역을 설정하는 것으로, 주로 서비스되는 지역과 가까운 곳을 지정한다.
존에 대한 내용은 <a href="https://cloud.google.com/compute/docs/regions-zones/">https://cloud.google.com/compute/docs/regions-zones/</a>를 참조한다.
</p>

<h3>Git</h3>

<p>
<a href="https://git-scm.com">https://git-scm.com</a>에서 최신 바이너리 파일을 다운로드하고 압축을 푼다.
압축을 풀고 생성된 디렉터리를 적당한 곳으로 옮긴 후 Git의 bin 디렉터리의 경로를 PATH 환경변수에 추가한다.
</p>

<p>
사용자 정보를 설정한다.
</p>

<pre class="screen">
git config --global user.name "<em>Gildong Hong</em>"
git config --global user.email <em>hong@gmail.org</em>
</pre>

<p>
설정을 확인한다.
</p>

<pre class="screen">
git config --global --list
</pre>

<h3>이클립스</h3>

<p>
<a href="http://www.eclipse.org">www.eclipse.org</a>에서 이클립스 인스톨러 파일을 내려받는다.
압축을 풀고 생성된 디렉터리에서 eclipse-inst로 시작하는 이클립스 인스톨러를 실행한 후 Java EE Developers를 설치한다.
</p>

<h2>구글 앱 엔진 방명록(guestbook) 아키타입 생성</h2>

<p>
자신이 지정한 워크스페이스에서 다음 명령을 실행한다.
</p>

<strong class="screen-header"><b>C:\</b> Command Prompt</strong>
<pre class="screen">
C:\Lab&gt;<b>mvn archetype:generate -Dappengine-version=1.9.67 -Dfilter=com.google.appengine.archetype:</b>

Choose archetype:
1: remote -&gt; com.google.appengine.archetypes:appengine-flexible-archetype
2: remote -&gt; com.google.appengine.archetypes:appengine-skeleton-archetype
3: remote -&gt; com.google.appengine.archetypes:appengine-standard-archetype
4: remote -&gt; com.google.appengine.archetypes:endpoints-skeleton-archetype
5: remote -&gt; com.google.appengine.archetypes:guestbook-archetype
6: remote -&gt; com.google.appengine.archetypes:hello-endpoints-archetype
7: remote -&gt; com.google.appengine.archetypes:skeleton-archetype (-)
Choose a number or apply filter (format: [groupId:]artifactId, case sensitive contains): : <b>5</b> 
Choose com.google.appengine.archetypes:guestbook-archetype version: 
1: 1.7.4
2: 1.7.4.1
3: 1.7.5
4: 1.7.6
5: 1.7.7
6: 1.8.4
7: 2.0.0-1.9.10
8: 3.0.0-1.9.20
9: 3.0.1-1.9.21
10: 3.0.1-1.9.25
11: 3.0.2-1.9.38
12: 3.1.0-1.9.42
13: 4.0.0
14: 4.0.1
15: 4.0.2
Choose a number: 15: <b>14</b> 
Define value for property 'groupId': : <b>net.java_school.guestbook</b>
Define value for property 'artifactId': : <b>guestbook</b>
Define value for property 'version':  1.0-SNAPSHOT: : <b>↵</b>
Define value for property 'package':  net.java_school.guestbook: : <b>↵</b>
[INFO] Using property: CloudSDK_Tooling = true
[INFO] Using property: appengine-version = 1.9.67
[INFO] Using property: application-id = your-app-id
[INFO] Using property: java8 = true
[INFO] Using property: service = default
Confirm properties configuration:
groupId: net.java_school.guestbook
artifactId: guestbook
version: 1.0-SNAPSHOT
package: net.java_school.guestbook
CloudSDK_Tooling: true
appengine-version: 1.9.67
application-id: your-app-id
java8: true
service: default
 Y: : <b>↵</b>
[INFO] ----------------------------------------------------------------------------
[INFO] Using following parameters for creating project from Archetype: guestbook-archetype:4.0.1
[INFO] ----------------------------------------------------------------------------
[INFO] Parameter: groupId, Value: net.java_school.guestbook
[INFO] Parameter: artifactId, Value: guestbook
[INFO] Parameter: version, Value: 1.0-SNAPSHOT
[INFO] Parameter: package, Value: net.java_school.guestbook
[INFO] Parameter: packageInPathFormat, Value: net/java_school/guestbook
[INFO] Parameter: CloudSDK_Tooling, Value: true
[INFO] Parameter: groupId, Value: net.java_school.guestbook
[INFO] Parameter: service, Value: default
[INFO] Parameter: version, Value: 1.0-SNAPSHOT
[INFO] Parameter: application-id, Value: your-app-id
[INFO] Parameter: package, Value: net.java_school
[INFO] Parameter: artifactId, Value: guestbook
[INFO] Parameter: java8, Value: true
[INFO] Parameter: appengine-version, Value: 1.9.67
[INFO] project created from Archetype in dir: C:\Lab\guestbook
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 01:30 min
[INFO] Finished at: 2018-01-14T23:02:25+09:00
[INFO] Final Memory: 11M/50M
[INFO] ------------------------------------------------------------------------
</pre>

<p>
빌드가 완료되면 artifactId 값과 같은 이름의 서브 폴더가 생긴다.
artifactId 값이 guestbook 이므로 guestbook/ 서브 폴더가 생긴다.
guestbook/ 폴더로 이동하여 mvn clean package 명령을 실행한다.
</p>

<strong class="screen-header"><b>C:\</b> Command Prompt</strong>
<pre class="screen">C:\Lab&gt;<b>cd guestbook</b>
C:\Lab\guestbook&gt;<b>mvn clean package</b>
</pre>

<p style="font-weight: bold;font-style: italic;color: red;">
여기서 에러를 만나면, src/test/java/의 모든 서브 폴더를 삭제한 후 다시 mvn clean package를 실행한다.
</p>

<h3>로컬 테스트</h3>

<p>
로컬 테스트를 위한 명령어는 mvn appengine:run 이다.
</p>

<strong class="screen-header"><b>C:\</b> Command Prompt</strong>
<pre class="screen">C:\Lab\guestbook&gt;<b>mvn appengine:run</b>
</pre>

<p>
Dev App Server is now running이 보이면, 웹 브라우저로 http://localhost:8080을 방문하여 테스트한다.
테스트가 끝나면 Ctrl + C로 종료한다.
</p>

<h3>서버 테스트</h3>

<p>
pom.xml을 열고 &lt;!-- &lt;app.deploy.project&gt;your-app-id&lt;/app.deploy.project&gt; --&gt;
에서 your-app-id를 자신의 프로젝트 아이디로 수정한 후 주석을 제거한다.
</p>

<pre class="prettyprint">
&lt;properties&gt;
    <strong>&lt;app.deploy.project&gt;<em>프로젝트 아이디</em>&lt;/app.deploy.project&gt;</strong>
</pre>

<p>
서버로 앱을 배포하려면 명령 프롬프트에서 mvn appengine:deploy를 실행한다.
</p>

<strong class="screen-header"><b>C:\</b> Command Prompt</strong>
<pre class="screen">C:\Lab\guestbook&gt;<b>mvn appengine:deploy</b>
</pre>

<p>
빌드가 성공하면 https://프로젝트 아이디.appspot.com을 방문한다.
로컬 테스트와 달리 다음과 같은 서버 에러를 만날 것이다.
<img alt="First Server Error" src="https://lh3.googleusercontent.com/WBI0ZTUKVl8OJBgXJWUBq43QZ6dj51p9e2qLZKoUDu6XfpoiSIADFrhDfWxtLAxVfKVh93jcnewfhrZXJRF1LWU3SQbOorO-9IQ5kEv7VtyvKGzfQM6u9pPafFD-83U7Iv3F4ku8EdhZbpzlDTRdaBB33-bBoPaZIpw5gpO-x_rdrcPwgj9KJgUByd4wqr8ZvwYC3ycMfcO2yvmlKTwiinGRl-YRQKvAnos9fZSvt5zUMj94tZ87YlRbryiftHpKTIWJ2RobxmXvakdXJmiccj9u6lCntlbRB9zuSH31z_P_vv49jrBQA9qtDuH9HSe7KXTapInk5AO_45e4RxtFNZ6sgCndkIgFRqCOt5BA3d7eZY0efWw94HIIci8LB3h5jhhjQK_YaS2CIavP0qyBMldNflZh2aNPE4qAVtY5qVP9CTz7-o4m7tKAvOrIvsyk-oZGNxnwASUKjKfn9U5P12Ami6rn51cK01Q3J5DJQEKKH9zz9_Wl-P0a05QlD1nk1Sa9TlbfR454RmEzBgA5QLBRxjUWZQmpefJV7aCYJ7ya5beVnS5_je7kX98AJKwZJJ0K7KU3W_MWvCFH1XKfqTSIm7dryufY5DbNsl_7UZbGQ6QyRmSPWQp4=w846-h223-no" style="display: block;" />
하지만 몇 분 후 다시 접속하면 서버 에러가 사라지고 방명록 화면을 볼 수 있다.
<img alt="First Remote Test" src="https://lh3.googleusercontent.com/mUnkUemqhzcVDPF-PdDHu4MQuv1hbWjv0Ede8RNDiKTh5lTuaayYew9l6DAodL1v2K5V44_4ozY0VeUxE0TD37uY6s4kHkKtrBwOOQ8PzUZppVVHebhr_1xvOFlFTNkE1NPtsJSJRAvcMQwMK6WnPIlgGGCaVk6pOWWjyVa3XYs60BBbyCQoEGjeHCSxy5yF_k3gufQs5aftaQEdyzWrFobwx45zlHoMUuSqST6xNzUMEuVbG2YYBg2zYGy5RsAXgsrD_OEvrG7vKGAoscpROZbxFPcpk_0VXr4ac0yfcFMyB2d0V14f_v3bS-pA9xsoNFK_FktFeAsDumfS9fdGUO8U0aCwOxxZ5kzfvlG3ZyT5SUn5sU-tL0Rp_BJQ_zz7C4aVRlhFHXgND20uuHMX2aZYWPcDZngS6zmQVa1b4J3E_9y_iIrUWK2eHicDIxki6GSkAyAxpZA91h9CCrSPRhFvVS9wNJ-3FkY1XE5CGfkcyunva1S1nqwqHwtg8BOAmTmbQpGs5jsBCob8BL2thPdTn6MnEOyY1LqI4o696oEg7Axou5A7vnbfJZyeBBotOcvmDih3okCx07T9-HuOekpXkrBiGZgDdRAaBykt1xWajuldcZSGWs7M=w560-h408-no" style="display: block;" />
</p>

<p>
에러 원인은 데이터스토어 인덱스가 생성되기 전에 방문했기 때문이다.
데이터스토어 인덱스는 생성되는 데 몇 분 정도 소요된다.
인덱스가 없어서 발생하는 서버 에러의 경우, 구글 클라우드는 로그 메시지를 통해 자세한 내용을 알려준다.
<img src="https://lh3.googleusercontent.com/0v5LYyJLB1vPfrBSVQnJP36YVmteWiilewxxoeDgbxgD3EH7Bsr79jnGeqnyPAbei3IalH53P5YjoIv9vmSLIujligLMpMtXiiJuXzLHl7VaPbTrYPNOfLlKSPOXIbfyrZstE_kUhKut3H-wqkodd-u3aYzlQJqwcJCcMYPNqQInhLUNE9aFz7kywaj3NnLl6L6IyuA3So_gBEH7C8Te1DPP5JqhAxZfKrbwe_fpexsGO7d54Gxz41wSuTGpWiZfHaJQ2DHfTChXxrOAByT9VALF4jZjvM8Kvn28AMGTyvzfGb2XQLpLBT3OTPy-2BFz9VSBQHXZ6hsMv875E1hfyQFJAb-zGdQeb5glEss5N01FeoLbfDrI7JAMjZ8T-SeTrKj164j-Gw5G8wejS2bIQLzkNPwRmE4apJQT80URAoacQiJ5edhaThjf87SVxAHaoPxK6j9lbB-lrL0ILe-PmIpqpuLtAZEBm2huBWUg-HecNXx7jrJvbBm8TNm8FReTerMbuZO0BmD4MQXklu__HLhmgPJjMbboWib6ViWPsQ44xL6u1z29yrQR-4NJhx17JMWtLcEbYuAniraSJU2y53z5PhGh13ymUdVrGpP1pw=w884-h596-no" alt="log message" />  
</p>

<p>
데이터스토어 인덱스는 구글 클라우드 콘솔에서 확인할 수 있다.
<img src="https://lh3.googleusercontent.com/c-QAudFDFDS9AI5lOnG1ZJdd8qqPWy756DktSraa6kiRwnJy2CHLnSWxjAplT8jVdJbkA6KhSuvSZIzHWDJNmGZut7gr8sGVCWjIR5b7eyiLLRLGqL7zub8Wq0MeO6IEGhjLUK2GIYUkkgv_4_7QBNJy4LI3Z_u9Qb8vJjdxCGNoDVCbO6dyPNWGtJiN3UR01nlxEbp0cLkV2bSLMPU9Vkan3_8QlsEkgTqIW8HD1nuZpYV48TovHlOGyjEF8PRqADnZ51V4WWSmEuIOGs1eWkc5At-4N53Y2mD0nAz9tuWXUiZ41peQtL3491PNc7He-LAN4lgNC0U_lVhj0rH1gbDwcgRqZxFaWxsqMvcWsTgQRxuofqAHWAkU7L3Dg7kH9NC6jUBLcTy84hzCrrXAeqIz7pzFP0mdbtwZ3jucwMFyRk_IlBNXH0-xBKN1NMP9kkxrdy59yIU5lYQ2Md5N1vicmyi9GpBPAnhY6VK6nWJG1lwT6_jP9UR9n0xUoBijX2gPdVpa598szjIRLEBBvvRs0Bl8O4F8YKGBnwGg2xISAhmFXVqZT3rMxoBO27p4HNH7f1wY8MvYZoZzQJxpiVeBxXqoD_3xor9QHTFVHw=w1116-h336-no" alt="datatore indexes" />
</p>

<h2>Git 저장소 생성</h2>

<p>
gcloud source repos create "저장소 이름" 으로 구글 클라우드에 개인 저장소를 생성한다.
</p>

<pre class="screen">
gcloud source repos create firstGaePjt
</pre>

<p>
firstGaePjt 저장소를 구글 클라우드에 생성했다.
</p>

<p>
gcloud source repos clone "저장소 이름" 으로 로컬 저장소를 생성한다.
</p>

<pre class="screen">
C:\Lab&gt;gcloud source repos clone firstGaePjt
</pre>

<p>
firstGaePjt라는 이름으로 로컬 저장소를 개발 시스템에 생성했다.<br />
원격 저장소에 아무런 내용이 없으므로 <em>warning: You appear to have cloned an empty repository.</em>라는 메시지가 보이는 것은 당연하다.
생성된 firstGaePjt라는 디렉터리가 소스가 위치할 곳이다.
C:\Lab\guestbook의 모든 파일을 C:\Lab\firstGaePjt 디렉터리에 복사한다.
</p>

<p>
이후는 일반적인 git 사용법과 같다.
</p>

<pre class="screen">
git add . -A
git commit -m "First Commit"
git push origin master
</pre>

<span id="refer">참고</span>
<ul id="references">
	<li><a href="https://cloud.google.com/appengine/docs/standard/java/quickstart">https://cloud.google.com/appengine/docs/standard/java/quickstart</a></li>
	<li><a href="https://cloud.google.com/appengine/docs/standard/java/tools/maven">https://cloud.google.com/appengine/docs/standard/java/tools/maven</a></li>
	<li><a href="https://cloud.google.com/compute/docs/regions-zones/">https://cloud.google.com/compute/docs/regions-zones/</a></li>
	<li><a href="https://cloud.google.com/source-repositories/pricing">https://cloud.google.com/source-repositories/pricing</a></li>
	<li><a href="https://cloud.google.com/free/docs/always-free-usage-limits">https://cloud.google.com/free/docs/always-free-usage-limits</a></li>
	<li><a href="https://cloud.google.com/free/docs/frequently-asked-questions#free-trial">https://cloud.google.com/free/docs/frequently-asked-questions#free-trial</a></li>
	<li><a href="https://cloud.google.com/source-repositories/docs/quickstart">https://cloud.google.com/source-repositories/docs/quickstart</a></li>
	<li><a href="https://cloud.google.com/appengine/docs/standard/java/download">https://cloud.google.com/appengine/docs/standard/java/download</a></li>
	<li><a href="https://cloud.google.com/appengine/docs/java/">https://cloud.google.com/appengine/docs/java/</a></li>
	<li><a href="https://cloud.google.com/appengine/docs/standard/java/">https://cloud.google.com/appengine/docs/standard/java/</a></li>
	<li><a href="https://cloud.google.com/appengine/docs/standard/java/gettingstarted/creating-guestbook">https://cloud.google.com/appengine/docs/standard/java/gettingstarted/creating-guestbook</a></li>
	<li><a href="https://cloud.google.com/sdk/downloads">https://cloud.google.com/sdk/downloads</a></li>
</ul>
</article>